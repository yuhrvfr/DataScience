<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Introduction:</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h2>Introduction:</h2>

<p>Using Machine learning method to predict Weight lifting exercises outcome.
The data is provided by Qualitative Activity Recognition of Weight Lifting Exercises. This is the document <a href="http://groupware.les.inf.puc-rio.br/public/papers/2013.Velloso.QAR-WLE.pdf">http://groupware.les.inf.puc-rio.br/public/papers/2013.Velloso.QAR-WLE.pdf</a>, the paragraph (5.1 Feature extraction and selection) describes the contents of the dataset. The exercises are classified into 5 classes: A, B, C, D, E. The datasets can be downloaded <a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv</a> and <a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv</a></p>

<h3>The question:</h3>

<p>From the dataset provided, predict the class of the weight lefting exercise class.</p>

<h3>The input are 2 sets of data:</h3>

<ul>
<li>Training set with 19622 rows of 160 features</li>
<li>Test set with 20 rows without the target prediction column &ldquo;classe&rdquo;</li>
</ul>

<h3>The approach:</h3>

<h4>1) To allow cross validation, the training dataset is split into subtraining and subtesting datasets.</h4>

<pre><code class="r">library(caret);library(rpart);library(rattle);library(rpart.plot);library(randomForest);library(xtable);set.seed(32323)
training &lt;- read.csv(&quot;pml-training.csv&quot;)
# cross validation into subtrain and subtest
insubtrain &lt;- createDataPartition(y=training$classe,p=.75,list=FALSE)
subtrain  &lt;- training[insubtrain,];subtest   &lt;- training[-insubtrain,]
# display some variable class
sapply(subtrain,class)
</code></pre>

<h4>2) The analysis is conducted on the subtraining dataset</h4>

<p><strong>Feature selection using data exploratory</strong>
Among the 160 variables in the subtrain dataset: some are irrelevant for weight lifting exercise analysis (user_name, new_windows, raw_timestamp_part_1,..), some are incompleted not usable as such, they might need estimations such as center, scale method, we might come back, but for now since have plenty of variables, all incomplete data will be put aside. In total 50 variables are retained. For clarity reason, please refer to <strong>annexe A1</strong> for code of this section and the list of variables retained.</p>

<p><strong>Select the algorithm for maching learning :</strong></p>

<p>Since the outcome is categorical, categorical model approach is more appropriate compare to linear model.</p>

<p><strong>a) Tree with Principal Component analysis</strong></p>

<pre><code class="r">prComp &lt;- prcomp(subtrainb[,-c(54)]); preProc &lt;- preProcess(subtrainb[,-c(54)],method=&quot;pca&quot;,pcaComp=10); subtrainbPC &lt;- predict(preProc,subtrainb[,-c(54)])
fitpca &lt;- rpart(subtrainb$classe~.,data=subtrainbPC); pred &lt;- predict(fitpca,subtrainbPC,type=&quot;class&quot;);
xt &lt;- table(pred, subtrain$classe);kable(xt, format = &quot;markdown&quot;)
</code></pre>

<table><thead>
<tr>
<th align="left"></th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
</tr>
</thead><tbody>
<tr>
<td align="left">A</td>
<td align="right">2383</td>
<td align="right">368</td>
<td align="right">513</td>
<td align="right">115</td>
<td align="right">392</td>
</tr>
<tr>
<td align="left">B</td>
<td align="right">521</td>
<td align="right">1284</td>
<td align="right">351</td>
<td align="right">512</td>
<td align="right">655</td>
</tr>
<tr>
<td align="left">C</td>
<td align="right">708</td>
<td align="right">423</td>
<td align="right">1386</td>
<td align="right">357</td>
<td align="right">531</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">344</td>
<td align="right">451</td>
<td align="right">80</td>
<td align="right">1243</td>
<td align="right">347</td>
</tr>
<tr>
<td align="left">E</td>
<td align="right">229</td>
<td align="right">322</td>
<td align="right">237</td>
<td align="right">185</td>
<td align="right">781</td>
</tr>
</tbody></table>

<p><strong>b) Tree Model</strong></p>

<pre><code class="r">fit2 &lt;- rpart(classe ~ ., data = subtrainb)
pred &lt;- predict(fit2,subtrain,type=&quot;class&quot;)
xt &lt;- table(pred, subtrain$classe)
xt &lt;- table(pred, subtrain$classe);kable(xt, format = &quot;markdown&quot;)
</code></pre>

<table><thead>
<tr>
<th align="left"></th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
</tr>
</thead><tbody>
<tr>
<td align="left">A</td>
<td align="right">3795</td>
<td align="right">441</td>
<td align="right">47</td>
<td align="right">108</td>
<td align="right">14</td>
</tr>
<tr>
<td align="left">B</td>
<td align="right">293</td>
<td align="right">2108</td>
<td align="right">284</td>
<td align="right">635</td>
<td align="right">510</td>
</tr>
<tr>
<td align="left">C</td>
<td align="right">0</td>
<td align="right">154</td>
<td align="right">2024</td>
<td align="right">81</td>
<td align="right">8</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">83</td>
<td align="right">63</td>
<td align="right">181</td>
<td align="right">1448</td>
<td align="right">141</td>
</tr>
<tr>
<td align="left">E</td>
<td align="right">14</td>
<td align="right">82</td>
<td align="right">31</td>
<td align="right">140</td>
<td align="right">2033</td>
</tr>
</tbody></table>

<p><strong>c) Random Forest Model</strong></p>

<pre><code class="r">rf &lt;- randomForest(classe~.,data=subtrainb);pred &lt;- predict(rf,subtrain);xt &lt;- table(pred, subtrain$classe);kable(xt, format = &quot;markdown&quot;)
</code></pre>

<table><thead>
<tr>
<th align="left"></th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
</tr>
</thead><tbody>
<tr>
<td align="left">A</td>
<td align="right">4185</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="right">0</td>
<td align="right">2848</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2567</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2412</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">E</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2706</td>
</tr>
</tbody></table>

<p><strong>Compare the models and evaluate the error</strong>
Since those are categorical model, one of the common measures of errors is the accuracy returned by the confusion matrix. The Random forest model provides the highest accuracy on the sub-training set. We will select this model.</p>

<h4>3) Predict on the result on the sub testing set with the Random forest model</h4>

<pre><code class="r">pred &lt;- predict(rf,subtest); xt &lt;- table(pred, subtest$classe)
kable(xt, format = &quot;markdown&quot;)
</code></pre>

<table><thead>
<tr>
<th align="left"></th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
</tr>
</thead><tbody>
<tr>
<td align="left">A</td>
<td align="right">1395</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="right">0</td>
<td align="right">946</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">852</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">800</td>
<td align="right">0</td>
</tr>
<tr>
<td align="left">E</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">901</td>
</tr>
</tbody></table>

<p>The confusion matrix shows the model also provides a good result 99.8% on this cross-validation sub testing set. Note it is not as perfect as it was against the sub training set. This is expected, the prediction should be most accurate on the dataset, from which the model was built. In other words, <strong>out of samples error is usually greater than in sample errors</strong>.</p>

<h4>4) Apply the model extracted from the training dataset to the testing dataset</h4>

<pre><code class="r">testing &lt;- read.csv(&quot;pml-testing.csv&quot;);predtest &lt;- predict(rf,testing);predtest
</code></pre>

<p>1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 
 B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B 
Levels: A B C D E</p>

<h4>Annexe A1</h4>

<p><strong>Reducing the dataset to the quantitative and complete data</strong></p>

<p>inl &lt;- function(x) {
if (x %in% c(&ldquo;kurtosis_roll_belt&rdquo;,&ldquo;kurtosis_picth_belt&rdquo;,&ldquo;kurtosis_yaw_belt&rdquo;,&ldquo;skewness_roll_belt&rdquo;,&ldquo;skewness_roll_belt.1&rdquo;,&ldquo;skewness_yaw_belt&rdquo;,&ldquo;max_yaw_belt&rdquo;,
&ldquo;min_yaw_belt&rdquo;,&ldquo;amplitude_yaw_belt&rdquo;,&ldquo;kurtosis_roll_arm&rdquo;,&ldquo;kurtosis_picth_arm&rdquo;,&ldquo;kurtosis_yaw_arm&rdquo;,&ldquo;skewness_roll_arm&rdquo;,&ldquo;skewness_pitch_arm&rdquo;,  &ldquo;skewness_yaw_arm&rdquo;,&ldquo;kurtosis_roll_dumbbell&rdquo;,&ldquo;kurtosis_picth_dumbbell&rdquo;,&ldquo;kurtosis_yaw_dumbbell&rdquo;,&ldquo;skewness_roll_dumbbell&rdquo;,&ldquo;skewness_pitch_dumbbell&rdquo;,&ldquo;skewness_yaw_dumbbell&rdquo;,&ldquo;amplitude_yaw_dumbbell&rdquo;,&ldquo;kurtosis_roll_forearm&rdquo;,&ldquo;kurtosis_picth_forearm&rdquo;,  &ldquo;kurtosis_yaw_forearm&rdquo;, &ldquo;skewness_roll_forearm&rdquo;,&ldquo;skewness_pitch_forearm&rdquo;,   &ldquo;skewness_yaw_forearm&rdquo;,&ldquo;max_yaw_forearm&rdquo;,&ldquo;min_yaw_forearm&rdquo;,&ldquo;X&rdquo;,&ldquo;max_roll_belt&rdquo;, 
&ldquo;max_picth_belt&rdquo;,   &ldquo;min_roll_belt&rdquo;,    &ldquo;min_pitch_belt&rdquo;,   &ldquo;amplitude_roll_belt&rdquo;,&ldquo;amplitude_pitch_belt&rdquo;,&ldquo;var_total_accel_belt&rdquo;,    &ldquo;avg_roll_belt&rdquo;,&ldquo;stddev_roll_belt&rdquo;,&ldquo;var_roll_belt&rdquo;,&ldquo;avg_pitch_belt&rdquo;,    &ldquo;stddev_pitch_belt&rdquo;,&ldquo;var_pitch_belt&rdquo;,   &ldquo;avg_yaw_belt&rdquo;, &ldquo;stddev_yaw_belt&rdquo;,&ldquo;var_yaw_belt&rdquo;,&ldquo;var_accel_arm&rdquo;,   &ldquo;avg_roll_arm&rdquo;, 
&ldquo;stddev_roll_arm&rdquo;,&ldquo;var_roll_arm&rdquo;,   &ldquo;avg_pitch_arm&rdquo;,&ldquo;stddev_pitch_arm&rdquo;, &ldquo;var_pitch_arm&rdquo;,&ldquo;avg_yaw_arm&rdquo;,&ldquo;stddev_yaw_arm&rdquo;, &ldquo;var_yaw_arm&rdquo;,&ldquo;max_roll_arm&rdquo;,   &ldquo;max_picth_arm&rdquo;,&ldquo;max_yaw_arm&rdquo;,  &ldquo;min_roll_arm&rdquo;, &ldquo;min_pitch_arm&rdquo;,    &ldquo;min_yaw_arm&rdquo;,  &ldquo;amplitude_roll_arm&rdquo;,   &ldquo;amplitude_pitch_arm&rdquo;,  &ldquo;amplitude_yaw_arm&rdquo;,&ldquo;max_roll_dumbbell&rdquo;,    &ldquo;max_picth_dumbbell&rdquo;,   &ldquo;max_yaw_dumbbell&rdquo;, &ldquo;min_roll_dumbbell&rdquo;,    &ldquo;min_pitch_dumbbell&rdquo;,   &ldquo;min_yaw_dumbbell&rdquo;,&ldquo;amplitude_roll_dumbbell&rdquo;,&ldquo;amplitude_pitch_dumbbell&rdquo;,&ldquo;var_accel_dumbbell&rdquo;,   &ldquo;avg_roll_dumbbell&rdquo;,    &ldquo;stddev_roll_dumbbell&rdquo;, &ldquo;var_roll_dumbbell&rdquo;,    &ldquo;avg_pitch_dumbbell&rdquo;,   &ldquo;stddev_pitch_dumbbell&rdquo;,    &ldquo;var_pitch_dumbbell&rdquo;,   &ldquo;avg_yaw_dumbbell&rdquo;, &ldquo;stddev_yaw_dumbbell&rdquo;,  &ldquo;var_yaw_dumbbell&rdquo;,&ldquo;max_roll_forearm&rdquo;,  &ldquo;max_picth_forearm&rdquo;,    &ldquo;min_roll_forearm&rdquo;, &ldquo;min_pitch_forearm&rdquo;,    &ldquo;amplitude_roll_forearm&rdquo;,   &ldquo;amplitude_pitch_forearm&rdquo;,&ldquo;var_accel_forearm&rdquo;,  &ldquo;avg_roll_forearm&rdquo;, &ldquo;stddev_roll_forearm&rdquo;,&ldquo;var_roll_forearm&rdquo;,   &ldquo;avg_pitch_forearm&rdquo;,    &ldquo;stddev_pitch_forearm&rdquo;, &ldquo;var_pitch_forearm&rdquo;,    &ldquo;avg_yaw_forearm&rdquo;,  &ldquo;stddev_yaw_forearm&rdquo;,   &ldquo;var_yaw_forearm&rdquo;,&ldquo;amplitude_yaw_forearm&rdquo;,&ldquo;new_window&rdquo;,&ldquo;user_name&rdquo;, &ldquo;raw_timestamp_part_1&rdquo;, &ldquo;raw_timestamp_part_2&rdquo;, &ldquo;cvtd_timestamp&rdquo;)){  FALSE } else {  TRUE }}
kp &lt;- sapply(names(subtrain), inl);subtrainb &lt;- subtrain[kp]</p>

<p><strong>List of the variables retained in the model:</strong> </p>

<p>num_window,roll_belt,pitch_belt,yaw_belt,total_accel_belt,gyros_belt_x,gyros_belt_y, gyros_belt_z,accel_belt_x,accel_belt_y,accel_belt_z,magnet_belt_x,magnet_belt_y  magnet_belt_z roll_arm,pitch_arm,yaw_arm,total_accel_arm,gyros_arm_x,gyros_arm_y  gyros_arm_z,accel_arm_x,accel_arm_y,accel_arm_z,magnet_arm_x,magnet_arm_y   magnet_arm_z,roll_dumbbell,pitch_dumbbell,yaw_dumbbell,total_accel_dumbbell,    gyros_dumbbell_x,gyros_dumbbell_y,gyros_dumbbell_z,accel_dumbbell_x,accel_dumbbell_y,accel_dumbbell_z,magnet_dumbbell_x,magnet_dumbbell_y,magnet_dumbbell_z,    roll_forearm,pitch_forearm,yaw_forearm,total_accel_forearm,gyros_forearm_x, gyros_forearm_y,gyros_forearm_z,accel_forearm_x,accel_forearm_y,accel_forearm_z,    magnet_forearm_x,magnet_forearm_y,magnet_forearm_z,classe.</p>

</body>

</html>
